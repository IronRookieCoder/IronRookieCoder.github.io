@startuml

/'
    基于LLM：代码分块、全局审查、语言特性识别、规则生成、分块审查、结果合并、审查结果过滤、代码修复
'/

代码预处理 -> 脚本抽离: 抽离 script 部分（Vue、HTML 文件）

par 分块审查与全局审查并行
    脚本抽离 -> 代码分块: 代码分块
    代码预处理 --> 全局审查: 代码全局审查
end

代码分块 -> 代码分块: 生成多个代码分块

par 并行执行
    代码分块 -> 语言特性识别: 识别分块的语言特性
    note right: 分块 -> 特性

    语言特性识别 -> 规则检索: 利用特性检索审查规则

    group 规则生成过程
        规则检索 -> 规则检索: 从知识库检索规则
        规则检索 -> 规则生成: 调用 LLM 补充规则
        规则生成 --> 规则检索: 返回规则
    end
    note left: 知识库+LLM动态生成

    规则检索 -> 分块审查: 利用特性审查规则强化审查
end

分块审查 -> 结果合并: 输出分块审查结果

全局审查 --> 结果合并: 输出全局审查结果

结果合并 -> 结果合并: 审查结果合并
结果合并 -> 审查结果过滤: 输出合并审查结果

审查结果过滤 -> 审查结果过滤: 过滤审查结果
审查结果过滤 -> 代码修复: 输出过滤后的审查结果

代码修复 -> 代码修复: 根据审查结果修复

@enduml